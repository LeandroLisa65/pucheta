#pragma checksum "/Users/leandrolisa/Projects/082023_PuchetaWEB_test/Gestion.Web/Views/ParteDiario2/_ParteDiarioIncidentes.cshtml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "c9431105f3a403c9aa5f94f6e42bf95167ca48b6"
// <auto-generated/>
#pragma warning disable 1591
[assembly: global::Microsoft.AspNetCore.Razor.Hosting.RazorCompiledItemAttribute(typeof(AspNetCore.Views_ParteDiario2__ParteDiarioIncidentes), @"mvc.1.0.view", @"/Views/ParteDiario2/_ParteDiarioIncidentes.cshtml")]
namespace AspNetCore
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Mvc;
    using Microsoft.AspNetCore.Mvc.Rendering;
    using Microsoft.AspNetCore.Mvc.ViewFeatures;
#nullable restore
#line 2 "/Users/leandrolisa/Projects/082023_PuchetaWEB_test/Gestion.Web/Views/_ViewImports.cshtml"
using Gestion.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "/Users/leandrolisa/Projects/082023_PuchetaWEB_test/Gestion.Web/Views/_ViewImports.cshtml"
using Gestion.Web.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "/Users/leandrolisa/Projects/082023_PuchetaWEB_test/Gestion.Web/Views/_ViewImports.cshtml"
using Gestion.Web.ViewModels.Input;

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"c9431105f3a403c9aa5f94f6e42bf95167ca48b6", @"/Views/ParteDiario2/_ParteDiarioIncidentes.cshtml")]
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"3bee31758dd1cbb7e600e265aed2cb74227e9428", @"/Views/_ViewImports.cshtml")]
    #nullable restore
    public class Views_ParteDiario2__ParteDiarioIncidentes : global::Microsoft.AspNetCore.Mvc.Razor.RazorPage<Gestion.EF.ReturnData>
    #nullable disable
    {
        #pragma warning disable 1998
        public async override global::System.Threading.Tasks.Task ExecuteAsync()
        {
            WriteLiteral("\r\n<div class=\"row\">\r\n    <div class=\"col-lg-12\">\r\n        <div class=\"card  card-rojo\">\r\n            <div class=\"card-header cabecera\">\r\n                <h5 class=\"m-0\"></h5>\r\n            </div>\r\n            <div class=\"card-body\">\r\n");
            WriteLiteral(@"                <div class=""row"">
                    <div id=""Novedades"" class=""col-md-12"">
                        <div class=""form-group"">
                            <div class=""row"">
                                <div class=""col-md-6"">
                                    <div class=""form-group"">
                                        <label class=""control-label"">Incidentes</label>
                                        <input id=""dllIncidentes"" />
                                    </div>
                                </div>
                                <div class=""col-md-6"">
                                    <label class=""control-label"">Solicitado Por</label>
                                    <input id=""txtUsuario"" type=""text"" class=""form-control"" disabled>
                                    
                                    <span class=""text-danger""></span>
                                </div>
                            </div>
                        </div>
      ");
            WriteLiteral(@"              </div>
                </div>
                <div class=""row"">
                    <div  class=""col-md-12"">
                        <div class=""form-group"">
                            <div class=""row"">
                                <div class=""col-md-3"">
                                    <div class=""form-group"">
                                        <label class=""control-label"">Contratista</label>
                                        <input id=""ddlContratistas"" />
                                    </div>
                                </div>
                                <div class=""col-md-3"">
                                    <div class=""form-group"">
                                        <label class=""control-label"">Fecha Cierre</label>
                                        <input id=""dtpFechaCierre"" type=""date"" name=""partydate"" class=""form-control"">
                                    </div>
                                </div>
                        ");
            WriteLiteral(@"        <div class=""col-md-3"">
                                    <div class=""form-group"">
                                        <label class=""control-label"">Asignación de Área</label>
                                        <div id=""dllAreas""></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class=""row"">
                <div class=""col-md-12"">
                    <div class=""form-group"">
                        <label>Comentario:</label>
                        <textarea id=""txtComentarioIncidente"" class=""form-control""></textarea>
                    </div>
                </div>
            </div>


                <div class=""row"">
");
            WriteLiteral(@"                    <div class=""form-group"">
                        <div class=""row"">
                            <div id=""divFUAbmIncidentes"" class=""col-md-12"">
                                <input type=""file""
                                       id=""inpFUAbmIncidentes""
                                       onchange=""SubirArchivos()""
                                       multiple
                                       class=""form-control""
                                       accept=""image/*, application/pdf,.csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"" />
                            </div>
                        </div>
                        
                    </div>


");
            WriteLiteral("                </div>\r\n                <div id=\"divGrillaAAAbmIncidentes\" class=\"col-md-2\"></div>\r\n                <div class=\"row\" style=\"justify-content: center\">\r\n                    <div class=\"col-md-2\"");
            BeginWriteAttribute("style", " style=\"", 4376, "\"", 4384, 0);
            EndWriteAttribute();
            WriteLiteral(@">
                        <div class=""btn-graba"" onclick=""Grabar_Incidente()"">
                            <i class=""fas fa-check""></i>
                            Grabar
                        </div>
                    </div>
                    <div class=""col-md-2"">
                        <div class=""btn-cerrar"" onclick=""LimpiarABM_Incidentes()"" data-dismiss=""modal"">
                            <i class=""far fa-times-circle""></i>
                            Cancelar
                        </div>
                    </div>
                </div>
                <div class=""row"">
                    <div class=""col-md-12"">
                        <div class=""form-group"">
                                <div id=""Conte_grillaIncidenteHistorial""></div>
                        </div>
                    </div>
                </div>

                </div>
            </div>
        </div>
    </div>
<input id=""NParteDiario"" type=""hidden"" />



");
            WriteLiteral(@"<div class=""modal fade  bd-example-modal-lg""
     id=""divMdlArchivos2""
     tabindex=""-1""
     role=""dialog""
     aria-labelledby=""myLargeModalLabel""
     aria-hidden=""true""
     data-backdrop=""static"">
    <div class=""modal-dialog  modal-lg"" role=""document"">
        <div class=""modal-content"">
            <div class=""modal-header cabecera"">
                <h5 id=""tituloMdlArchivos2"" class=""modal-title""></h5>
                <button type=""button"" style=""color:#FFFFFF"" class=""close"" data-dismiss=""modal"" aria-label=""Close"">
                    <span aria-hidden=""true"">&times;</span>
                </button>
            </div>
            <div class=""divBodyMdlArchivos2"">
            </div>

        </div>
    </div>
</div>





<script>
 /**************************************************VERSION-NUEVA************************************************* */
    var dataGlobal;
    var data = JSON.parse('");
#nullable restore
#line 148 "/Users/leandrolisa/Projects/082023_PuchetaWEB_test/Gestion.Web/Views/ParteDiario2/_ParteDiarioIncidentes.cshtml"
                      Write(Html.Raw(Json.Serialize(Model)));

#line default
#line hidden
#nullable disable
            WriteLiteral(@"');


    var IdProyecto=data.data;
    var ParteDiarioId = data.data1;


       var d = new Date();

    var month = d.getMonth() + 1;
    var day = d.getDate();
    var year = d.getFullYear();
    var day2 = d.getDate() + 5;

    if (month < 10)
        month = '0' + month;
    if (day < 10)
        day = '0' + day;
    if (day2 < 10)
        day2 = '0' + day2;

    var mFechaHoy = year + ""-"" + month + ""-"" + day;
    var mFechaFuturo = year + ""-"" + month + ""-"" + day2;
   var dateControl = document.querySelector('input[id=""dtpFechaCierre""]');
    dateControl.value = mFechaFuturo;

   



   /*CARGADORES DE COMBOS*/
    cargaIncidentes();
    cargaContratistas();
    cargarUsuario();
    cargaAreas();
    GetDatosGrillaIncidentesHistorial();


    function cargaIncidentes() {
        $.get(""");
#nullable restore
#line 187 "/Users/leandrolisa/Projects/082023_PuchetaWEB_test/Gestion.Web/Views/ParteDiario2/_ParteDiarioIncidentes.cshtml"
          Write(Url.Action("GetIncidente", "ParteDiario2"));

#line default
#line hidden
#nullable disable
            WriteLiteral(@""",    
            function (data2) {
                if (!data2.isError) {
                            $(""#dllIncidentes"").kendoDropDownList({
                                filter: ""startswith"",
                                dataTextField: ""nombre"",
                                dataValueField: ""id"",
                                optionLabel: ""Elegir Incidentes"",

                                dataSource: data2.data,
                                height: 400
                            });
                            /// 
                            

                }

            }
        );
    }

    function cargaContratistas() {
        $.get(""");
#nullable restore
#line 209 "/Users/leandrolisa/Projects/082023_PuchetaWEB_test/Gestion.Web/Views/ParteDiario2/_ParteDiarioIncidentes.cshtml"
          Write(Url.Action("GetContratistas", "ParteDiario2"));

#line default
#line hidden
#nullable disable
            WriteLiteral(@"/"" + IdProyecto,
            function (data) {

                if (!data.isError) {
                    $(""#ddlContratistas"").kendoDropDownList({
                        filter: ""startswith"",
                        dataTextField: ""sContratistas"",
                        dataValueField: ""contratistaId"",
                        optionLabel: ""Elegir Contratista"",
                        dataSource: data.data,
                        height: 400
                    });

                }

            }
        );
    }

    function cargarUsuario() {
        $.get(""");
#nullable restore
#line 229 "/Users/leandrolisa/Projects/082023_PuchetaWEB_test/Gestion.Web/Views/ParteDiario2/_ParteDiarioIncidentes.cshtml"
          Write(Url.Action("CargarUsuario", "ParteDiario2"));

#line default
#line hidden
#nullable disable
            WriteLiteral("/\" ,\r\n            function (data) {\r\n                if (!data.isError) {\r\n                    $(\"#txtUsuario\").val(data.data);\r\n\r\n                }\r\n\r\n            }\r\n        );\r\n    }\r\n\r\n     function cargaAreas() {\r\n            $.get(\"");
#nullable restore
#line 241 "/Users/leandrolisa/Projects/082023_PuchetaWEB_test/Gestion.Web/Views/ParteDiario2/_ParteDiarioIncidentes.cshtml"
              Write(Url.Action("GetAreasEmpresa", "ParteDiario2"));

#line default
#line hidden
#nullable disable
            WriteLiteral(@"/"" + IdProyecto,
                function (data) {

                    if (!data.isError) {
                        $(""#dllAreas"").kendoDropDownList({
                            filter: ""startswith"",
                            dataTextField: ""detalle"",
                            dataValueField: ""id"",
                            optionLabel: ""Elegir Area"",

                            dataSource: data,
                            height: 400
                        });

                    }

                }
            );
        }

    /*-------- */


    /* ARCHIVOS */

    var lArchivosAdjuntos = [];
    function SubirArchivos() {
        var formData = new FormData();
        var idInpFU = 'inpFUAbmIncidentes';
        var idDivFU = 'divFUAbmIncidentes';
        var idDivGrillaAAAbm = 'divGrillaAAAbmIncidentes';

        var inpFU = document.getElementById(idInpFU);
        console.log('-->',inpFU)
        if (inpFU.files.length) {
            for (var i = 0; i < i");
            WriteLiteral(@"npFU.files.length; i++) {
                formData.append('file_' + i, inpFU.files[i]);
            }
            $.ajax({
                type: ""POST"",
                enctype: 'multipart/form-data',
                url: ""/ArchivoAdjunto/SubirArchivos"",
                data: formData,
                processData: false,
                contentType: false,
                cache: false,
                timeout: 600000,
                success: function (res) {
                    if (res.error) {
                        toastr.error(res.message, { timeOut: 2000 });
                    } else {
                        res.lArchivosAdjuntos.forEach(aa => {
                            lArchivosAdjuntos.push(aa);
                        });
                       
                        CargarGrillaArchivosAdjuntos(idDivGrillaAAAbm);
                        var divFU = document.getElementById(idDivFU);
                        divFU.innerHTML =
                            `<input type=""file""");
            WriteLiteral(@"
                                        id=""`+ idInpFU + `""
                                        onchange=""SubirArchivos()""
                                        multiple class=""form-control""
                                        accept=""image/*, application/pdf,.csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel""/>`;
                    }
                }
            });
        }
    }

    function CargarGrillaArchivosAdjuntos(idDivGrilla) {
        var divArchivosAdjuntos = document.getElementById(idDivGrilla);
        var table = ""<table class='table'><tbody>"";
        lArchivosAdjuntos.forEach(aa => {
            var tr = ""<tr>"";
            tr += ""<td><a href='/"" + aa.url + aa.nombre + ""' target='_blank'>"" + aa.nombreOriginal + ""</a></td>"";
            tr += ""<td><button type='button' class='btn btn-secondary btn-xs' "" +
                ""onclick=\""EliminarArchivoAdjunto('"" + idDivGrilla + ""', "" + aa.archivos_AdjuntosId + "")\"">"" +");
            WriteLiteral(@"
                ""<i class='fas fa-trash'></i>"" +
                ""</button></td>"";
            tr += ""</tr>"";
            table += tr;
        });
        table += ""</tbody></table>"";
        divArchivosAdjuntos.innerHTML = table;

    }

    function EliminarArchivoAdjunto(idDivGrilla, id) {
        lArchivosAdjuntos = lArchivosAdjuntos.filter(function (aa) { return aa.archivos_AdjuntosId != id; });
        CargarGrillaArchivosAdjuntos(idDivGrilla);
    }

    /*------- */


    /*CARGAR INCIDENTES */
    function Grabar_Incidente() {
        var SolicitadoPor = $('#txtUsuario').val();
        var selectedValueContratista = $('#ddlContratistas').val();
        var Incidente = $('#dllIncidentes').val();
        var Fecha = $('#dtpFechaCierre').val();
        var AreaId = $('#dllAreas').val();

        var mRegOK = true;

        if (Incidente == ""0"") {
            toastr.error(""Debe seleccionar un Incidente"", { timeOut: 2000 });
            mRegOK = false;
        }
        if");
            WriteLiteral(@" (AreaId == ""0"") {
            toastr.error(""Debe seleccionar una Area"", { timeOut: 2000 });
            mRegOK = false;
        }
        if (selectedValueContratista == ""0"") {
            toastr.error(""Debe seleccionar un Contratista"", { timeOut: 2000 });
            mRegOK = false;
        }
        /*if (Fecha == ""0"") {
            toastr.error(""Debe seleccionar un Contratista"", { timeOut: 2000 });
            mRegOK = false;
        }*/
       

        if (mRegOK == true) {
            var lIdsArchivosAdjuntos = [];
            lArchivosAdjuntos.forEach(aa => lIdsArchivosAdjuntos.push(aa.archivos_AdjuntosId));
            var oIncidente = {
                ParteDiarioId: ParteDiarioId,
                ProyectoId:IdProyecto,
                IncidenteId: $('#dllIncidentes').val(),
                ComentarioHI :$('#txtComentarioIncidente').val(),
                SolicitadoPor: $('#txtUsuario').val(),
                ContratistaId:selectedValueContratista,
                FechaCierre");
            WriteLiteral(@": $('#dtpFechaCierre').val(),
                AreaId: $('#dllAreas').val(),
                lIdsArchivosAdjuntos: lIdsArchivosAdjuntos
            };
           $.post(""/ParteDiario2/ParteDiarioGrabaIncidentes/"", oIncidente).done(
                function (e) {
                    if (e.isError) {
                        toastr.error(e.data, { timeOut: 2000 });
                    } else {
                        toastr.success(e.data, { timeOut: 2000 });
                       LimpiarABM_Incidentes();
                        grillaIncidentesHistorial(e.data1);
                        
                    }
                }
            );
        }
    }
    /*------------ */

       /*LIMPIARDORES */
    function LimpiarABM_Incidentes() {


        $('#divGrillaAAAbmNovedades').html('');
        $(""#ddlContratistas"").data('kendoDropDownList').value(""0"");
        $(""#dllIncidentes"").data('kendoDropDownList').value(""0"");
        $(""#dllAreas"").data('kendoDropDownList').value(""0"");
");
            WriteLiteral(@"        $(""#dtpFechaCierre"").val('');
        
        $(""#txtComentarioIncidente"").val('');

        lArchivosAdjuntos = [];
        CargarGrillaArchivosAdjuntos('divGrillaAAAbmIncidentes');
        //$(""#dtpFechaCierre"").kendo.toString(new Date(), ""dd/MMMM/yyyy""); //""d"")
    }



   /*-------------- */

    /* Cargar Grilla*/
    function grillaIncidentesHistorial(data) {
        if ($('#id_Proyecto').val() > 0) {
            $('#tituloInciditendes').html('<b>Incidentes</b> ');
            $(""#Conte_grillaIncidenteHistorial"").html(""<div id='grillaIncidentesHistorial'></div>"");
            var colGrilla = [];
            colGrilla.push({ field: ""id"", title: ""Id"", media: ""(min-width: 450px)"", hidden: true });
            colGrilla.push({ field: ""sIncidente"", title: ""Incidente"", media: ""(min-width: 450px)"" });
            colGrilla.push({ field: ""comentario"", title: ""Comentario"", media: ""(min-width: 450px)"" });
            colGrilla.push({ field: ""sUsuarioDueño"", title: ""Solicitado Por"", ");
            WriteLiteral(@"media: ""(min-width: 450px)"" });
            //colGrilla.push({ command: { text: ""Archivos"", click: verArchivos_Incidentes }, title: ""Archivos"", width: ""165px"", attributes: { style: ""text-align:center;"" } });
            $(""#grillaIncidentesHistorial"").kendoGrid({
                filterable: true,
                sortable: true,
                groupable: true,
                reorderable: true,
                pageable: {
                    refresh: true,
                    pageSizes: true,
                    buttonCount: 20,
                },
                pageSize: 30,
                columnMenu: true,
                toolbar: [""excel""],
                excel: {
                    fileName: ""ParteDiarioIncidentes.xlsx"",
                    allPages: true,
                    filterable: true
                },
                dataSource: {
                    data: data
                },
                columns: colGrilla,
            });
        } else {
            $(""#Co");
            WriteLiteral(@"nte_grillaIncidenteHistorial"").html(""<div id='grillaIncidentesHistorial'></div>"");
            var colGrilla = [];
            colGrilla.push({ field: ""id"", title: ""Id"", media: ""(min-width: 450px)"", hidden: true });
            colGrilla.push({ field: ""sIncidente"", title: ""Incidente"", media: ""(min-width: 450px)"" });
            colGrilla.push({ field: ""creacion_Descripcion"", title: ""Comentario"", media: ""(min-width: 450px)"" });
            colGrilla.push({ field: ""sUsuarioDueño"", title: ""Solicitado Por"", media: ""(min-width: 450px)"" });
            colGrilla.push({ field: ""sContratista"", title: ""Contratista"", media: ""(min-width: 450px)"" });
            //colGrilla.push({ field: ""fecha_Cierre"", title: ""F. Cierre"", template: ""#= kendo.toString(kendo.parseDate(fecha_Cierre), 'dd/MM/yyyy') #"", width: ""90px"" });
            colGrilla.push({ command: { text: ""Archivos"", click: verArchivos_Incidentes }, title: ""ArchivosInh"", width: ""165px"", attributes: { style: ""text-align:center;"" } });
            $(""#grill");
            WriteLiteral(@"aIncidentesHistorial"").kendoGrid({
                filterable: true,
                sortable: true,
                groupable: true,
                pageSize: 30,
                pageable: {
                    refresh: true,
                    pageSizes: true,
                    buttonCount: 20,
                },
                reorderable: true,
                columnMenu: true,
                toolbar: [""excel""],
                excel: {
                    fileName: ""ParteDiarioIncidenteshistorial.xlsx"",
                    allPages: true,
                    filterable: true
                },
                dataSource: {
                    data: data
                },
                columns: colGrilla,
                dataBound: function () {
                    dataView = this.dataSource.view();
                    for (var i = 0; i < dataView.length; i++) {
                        if (dataView[i].isArchivosIncidentes) {
                            var uid = dataView[");
            WriteLiteral(@"i].uid;
                            $(""#grillaIncidentesHistorial tbody"").find(""tr[data-uid="" + uid + ""]"").find("".k-grid-ArchivosInh"").hide();
                        }
                    }
                }
            });
        }
    }
    

    function GetDatosGrillaIncidentesHistorial() {

        
        $.get(""/ParteDiario2/ParteDiarioIncidentesHistorialGet/"" + ParteDiarioId).done(function (e) {

            if (!e.isError) {
                grillaIncidentesHistorial(e.data);
                
            } else {
                toastr.error(e.data, { timeOut: 2000 });
            }
        });
    }


    async function VerArchivo() {
        await setTimeout(console.log(''), 2000);
    }

    async function verArchivos_Incidentes(e) {
        await VerArchivo();
        var oIncidente = this.dataItem($(e.currentTarget).closest(""tr""));
        var id = oIncidente.id;
        $('#tituloMdlArchivos2').html(""Archivos Incidentes"");
        $.get(""");
#nullable restore
#line 519 "/Users/leandrolisa/Projects/082023_PuchetaWEB_test/Gestion.Web/Views/ParteDiario2/_ParteDiarioIncidentes.cshtml"
          Write(Url.Action("_GetArchivos_ParteDiarioIncidentes", "ParteDiario2"));

#line default
#line hidden
#nullable disable
            WriteLiteral("/\" + id,\r\n            function (data) {\r\n                $(\'.divBodyMdlArchivos2\').html(data);\r\n            });\r\n        $(\'#divMdlArchivos2\').modal(\'show\');\r\n    }\r\n\r\n</script>\r\n");
        }
        #pragma warning restore 1998
        #nullable restore
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.ViewFeatures.IModelExpressionProvider ModelExpressionProvider { get; private set; } = default!;
        #nullable disable
        #nullable restore
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IUrlHelper Url { get; private set; } = default!;
        #nullable disable
        #nullable restore
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IViewComponentHelper Component { get; private set; } = default!;
        #nullable disable
        #nullable restore
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IJsonHelper Json { get; private set; } = default!;
        #nullable disable
        #nullable restore
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IHtmlHelper<Gestion.EF.ReturnData> Html { get; private set; } = default!;
        #nullable disable
    }
}
#pragma warning restore 1591
